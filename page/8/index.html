<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Adventures in HttpContext &middot; All the stuff after &#39;Hello, World&#39;
    
  </title>

  
  <link rel="stylesheet" href="http://blog.michaelhamrah.com/css/poole.css">
  <link rel="stylesheet" href="http://blog.michaelhamrah.com/css/syntax.css">
  <link rel="stylesheet" href="http://blog.michaelhamrah.com/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.michaelhamrah.com/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="http://blog.michaelhamrah.com/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.michaelhamrah.com/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Michael Hamrah</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item  active " href="http://blog.michaelhamrah.com/">Home</a>
    <a class="sidebar-nav-item " href="http://blog.michaelhamrah.com/post">Posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a class="sidebar-nav-item " href="http://blog.michaelhamrah.com/about/">About</a>
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="http://linkedin.com/in/hamrah">LinkedIn</a>
    <a class="sidebar-nav-item" href="http://twitter.com/mhamrah">@mhamrah</a>
    <a class="sidebar-nav-item" href="http://github.com/mhamrah">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="http://blog.michaelhamrah.com/" title="Home">Adventures in HttpContext</a>
            <small>All the stuff after &#39;Hello, World&#39;</small>
          </h3>
        </div>
      </div>

      <div class="container content">





<div class="posts">
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/05/great-site-for-the-ruby-on-rails-api/">Great Site for the Ruby on Rails API</a></h1>
        <span class="post-date">May 29 2009</span>
        <p>I came across this great site for the Ruby on Rails API:  <a href="http://railsapi.com" title="Ruby on Rails API">http://railsapi.com</a></p>

<p><a href="http://railsapi.com/doc/rails-v2.3.2.1_ruby-v1.9/">Here&#8217;s a link to Ruby 2.3.2.1 with Ruby 1.9.</a> Why is this great? It has a slick interface with a fast AJAX powered search filter.  From a UI perspective, it makes great use of whitespace and font sizing to present information clearly and legibly.  Finally, the simplistic color scheme is easy on the eyes.  Also includes links for source and github.</p>

<p>Bookmark it!</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/05/weird-issue-with-rspec-and-authlogic-openid/">Weird Issue with rspec and authlogic-openid</a></h1>
        <span class="post-date">May 24 2009</span>
        <p>I&#8217;ve been playing around rspec in my application which also uses <a href="http://github.com/binarylogic/authlogic_openid">AuthLogic&#8217;s OpenID</a>.  When doing</p>

<pre class="brush: bash; title: ; notranslate" title="">rake spec </pre>

<p>I get the following, very weird error:</p>

<pre class="brush: bash; title: ; notranslate" title="">(in /Users/Michael/r/wc)
/Users/Michael/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/base.rb:1964:in `method_missing': undefined method `config' for #&lt;Class:0x263efdc&gt; (NoMethodError)
from /Library/Ruby/Gems/1.8/gems/authlogic-oid-1.0.3/lib/authlogic_openid/acts_as_authentic.rb:35:in `optional_fields='
from /Users/Michael/r/wc/app/models/user.rb:3
from /Library/Ruby/Gems/1.8/gems/authlogic-2.0.13/lib/authlogic/acts_as_authentic/base.rb:37:in `acts_as_authentic'
from /Users/Michael/r/wc/app/models/user.rb:2
from /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
from /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
</pre>

<p>As seen above I&#8217;m using version 1.0.3 of the source code.  For the life of me, I couldn&#8217;t figure out what was wrong.  What was even stranger was the code was working when running the site.  It turns out, config got changed to rw_config, and the gem repository at rubyforge hasn&#8217;t been updated to the latest 1.0.4 <a href="http://github.com/binarylogic/authlogic_openid/commit/8a8c7729cf5590636892535167a86fffd40650b4">which includes this change</a>:</p>

<pre>Change from using config to the new rw_config. Requires the latest version 
of authlogic. config was too general of a name and was causing conflicts 
for people in their own projects.

</pre>

<p>So I changed the acts_as_authentic.rb file so config is named rw_config, and everything worked fine.</p>

<p>I&#8217;d love to find a good reference on how rspec loads gems, and why this isn&#8217;t an issue when running the site.  I&#8217;m also interested in knowning how to pull content as a gem from github source (the openid gem isn&#8217;t at gems.github.com).</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/05/i-hate-persistence-but-love-azure-table-storage-with-data-services/">I Hate Persistence (but love Azure Table Storage)</a></h1>
        <span class="post-date">May 12 2009</span>
        <p>If there&#8217;s one thing I can&#8217;t stand in the development process it&#8217;s writing code to save data.  In fact, there are only a few things which I&#8217;d consider more useless than dealing with data persistence- one of them being data migration.  I hate dealing with persistence because it&#8217;s totally mundane and repetitive code.  Worse, nobody outside of IT really understands the details of persistence.  Which means it has no business value.  And why should users care about unit of work or active record vs. repository?   Should saving an object really be that complicated of a task? Absolutely not.  Which is why no one cares.  It&#8217;s like caring about how your beer was delivered.  Really, I just want to drink the damn beer.  Yet somehow the thing which should be a no brainer takes the most time and effort to do.  And causes the most debate.  And causes the most problems.  However, I recently got my first glimmer of hope- a <em>cloud</em> with a silver lining- that maybe, just maybe, someday, we&#8217;ll actually have simple data access.</p>

<p>We as a development community have been transfixed on data access strategies.  It&#8217;s the great elephant in the room, and has totally consumed all our attention.  It&#8217;s distracting.  Only a .NET/Java language war in &#8217;04 could rival such a fierce debate as between <a href="http://ayende.com/Blog/archive/2009/04/26/the-repositoryrsquos-daughter.aspx">Ayende</a> and <a href="http://codebetter.com/blogs/gregyoung/archive/2009/04/24/more-on-repository.aspx">Greg Young</a> over the repository pattern. (My two cents: ActiveRecord. Just kidding, ActiveRecord sucks (not SRP). Use <a href="http:/www.subsonicproject.com">Subsonic</a>&#8211; which lost me at &#8220;drag and drop&#8221;, but <a href="http://blog.wekeroad.com/subsonic/subsonic-to-acquire-nhibernate/">I would not want to piss off Rob Conery</a>).</p>

<p>Why do I hate persistence?  It&#8217;s never really gotten any better.  The first major advancement came with sprocs.  Everything had to be a sproc, and if you weren&#8217;t using sprocs then you just weren&#8217;t cool.  You can do these great things with sprocs- like writing select statements with inner joins.  But not in your vbscript!  This mostly lead to awesome interview questions like &#8220;why are sprocs important&#8221; and dba&#8217;s who would whine about developers writing bad sql (guess what- they can write bad code too)!</p>

<p>Next, and silently from the Java community, we were given NHibernate and the concept of an object relational mapper.  Suddenly, an awakening occurred, and we as developers could now stick it to those dba&#8217;s and there precious sprocs.  Try changing my auto generated sql, you bastards! Unfortunately, the NHibernate craze did not take off.  We gave up sprocs for those awful configuration files- as if things could get any worse!  I personally have a big chip on my shoulder because NHibernate comes from the Java community.  Java, after all, just sucks (sidenote: this a totally baseless claim).  Fluent NHibernate doesn&#8217;t make it that much better: I&#8217;m not digging Cascade. All(). Inverse(). WithForeignKey(). WithIndex(). WithConvention(). ButNotForThisClass(). How. Many. Can. I. Add() and double code associations for parent/child relationships etc.  Not a big win.  But at least we can rub Fluent NHibernate in Hibernate&#8217;s xml hell!  Yes, there&#8217;s the auto mapper configuration which I admit is slick- but you&#8217;re kind of locked into the default convention (over configuration).  Stray from the path and you&#8217;re back in the configuration quicksand.  And don&#8217;t even get me started on the NHibernate query syntax.  Yes, there&#8217;s Linq to NHibernate, but why use that when you go directly to the best thing to come out of Microsoft since <a href="http://www.youtube.com/watch?v=8To-6VIJZRE">the Steve Ballmer video</a>.</p>

<p>Finally there was a breath of fresh air, and Microsoft was awesome again.  We were given Linq to Sql.  But when Microsoft realized they did something cool, they quickly pushed for Linq to Entities (oh wait- Entity Framework- Linq to Entities sounds like the cool Linq to Sql).  We were quickly back to the WTF relationship we have with Microsoft.  <strong>If you want to know why EF sucks, just try using it.</strong> Or check out <a href="http://naspinski.net/post/Linq-to-SQL-vs-Linq-to-Entities--Revisited.aspx">this good series of articles about l2s vs. l2e.</a> I gave up on Entity Framework when I tried setting up an auto generated db value on an insert.  It&#8217;s a pain in the ass and not nearly as simple as Linq To Sql&#8217;s &#8220;This is an auto generated property&#8221; property.</p>

<p>What are we left with?  Just the endless data access debate.  Which in a way is good for us because <strong>it keeps us from actually delivering something our users care about- like an app that saves data</strong>.  (Um, why can&#8217;t I change the customer address and overcharge them for adventure works gear at the same time??!?!?!)</p>

<p>So where&#8217;s the glimmer of hope?  Azure Table Storage- which might put us back in the Microsoft is cool again category.  Don&#8217;t worry Microsoft- you only support sorting on only one field (&#8220;Choose&#8230; Choose Wisely&#8221;), so I&#8217;m sure you can still spark lots of criticism.  But please give large bonuses to the people behind ATS.  Why is it so great?  The same reason Linq to Sql is great- it just works. ATS with ADO.NET Data Services is about as easy as you can do persistence without actually having to do it. (Side note: I&#8217;m ignoring object databases).  But you really have true POCO storage.  No messy attributes, no base classes, no schema generators, no xml configuration files, no .edmx files.  You have an object- it has public getters and setters- and you can save it.  That&#8217;s all you have to do.  The catch?  A row key and a partition key (Sidenote: I&#8217;m ignoring the whole deploy/run cloud part).  I could live without the partition key, but you&#8217;re not really asking for much.  What else? It&#8217;s built on Linq- and Linq, as we all know, is awesome (just like sql, but no strings!). (Sidenote: more criticism fuel: not all Linq operators are supported).</p>

<p>What else?  ATS is also schema free, so no more entity/table mappings.  Just save an object.  In fact, save different objects in the same table.  Like parent/child classes.  Together.  Like an aggregate root.  Then search on any field (sorry, still no sorting!)  That&#8217;s all you have to do.  And did I mention there&#8217;s no schema migration?  Because there&#8217;s no schema!  We&#8217;re free! Freedom! Sure, it&#8217;s <a href="http://aws.amazon.com/simpledb/">not the first schema free storage solution</a>&#8211; but it&#8217;s the only one backed with ADO.NET Data Services.  And that&#8217;s the special sauce which makes it yummy!</p>

<p>Yes, ATS isn&#8217;t perfect.  In fact it&#8217;s far from perfect.  But it&#8217;s a great step in the right direction.  NHibernate, Linq to Sql, EF, sprocs are all usable tools (sorry, didn&#8217;t mean to include EF).  There are some great 3rd party toolkits too, but if I have to pay for data access I&#8217;d like you to just do it or me.  There has been a great effort in the OS community (FluentNHibernate is a huge win) to make this stuff easier, but the bottom line is you&#8217;re doing double programming: you got your db and your code, and all that stuff that sits between is just crap.  Even with FluentNHibernate you&#8217;re just shifting your db programming to configuration.  At the end of the day doing data access well isn&#8217;t even a win because the user still doesn&#8217;t have a damn form!  ATS is different- it&#8217;s just really slick.  It&#8217;s scary slick.  Yes, it&#8217;s not ready for prime time, but it&#8217;s a huge step in the right direction.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/05/authlogic-and-openid-on-rails/">Authlogic and OpenID on Rails</a></h1>
        <span class="post-date">May 11 2009</span>
        <p>So, I&#8217;m working on a Rails App and I want to use OpenID (and only OpenID) for authentication.  I was going to use Restful_Authentication with the open_id_authentication extension, but then I saw Ryan Bates&#8217; <a href="http://www.railscasts.com">Railscast</a> on <a href="http://github.com/binarylogic/authlogic/tree/master">AuthLogic</a>.  Authlogic has an <a href="http://github.com/binarylogic/authlogic_openid/tree/master">OpenID extention</a> which looked perfect for my needs, and Authlogic seemed like a great gem for authentication.  My goal was simple: I wanted to support, and only support, authentication via OpenID.  None of this username/password/salt stuff.</p>

<p>Now, I should warn you: I HAVE NO IDEA WHAT I AM DOING.  I&#8217;m just getting started with Rails so I hit a few bumps getting this working.  I learned a lot along the way, so here&#8217;s a quick rundown of my adventure with Authlogic and OpenID on Rails.</p>

<p>First, getting started with sample code is always a good idea.  Authlogic has an <a href="http://github.com/binarylogic/authlogic_example/tree/master">example app</a> on github where you can check out how to use the gem.  After pulling down the code, I was surprised I couldn&#8217;t find anything relating to OpenID.  It turns out, the master repository doesn&#8217;t have the OpenID example.  But there&#8217;s a branch of the master example that does have the OpenID functionality.  Here&#8217;s how to get it:</p>

<p>First, clone the Authlogic example like so:</p>

<pre class="brush: bash; title: ; notranslate" title="">git clone git://github.com/binarylogic/authlogic_example.git</pre>

<p>Then, cd into the new Authlogic directory and get the OpenID fork like so:</p>

<pre class="brush: bash; title: ; notranslate" title="">git checkout --track -b authlogic_with_openid origin/with-openid</pre>

<p>Then, you can explore away.  My approach was simple: using the OpenID example as a guide, I&#8217;d start a new app and add OpenID support from Authlogic.</p>

<p>First, I need the required gems.  Authlogic and authlogic-oid are obvious, but I also need ruby-openid.  Authlogic-oid is built on the rails plugin open_id_authentication, which in turn is built on ruby-openid.</p>

<pre class="brush: bash; title: ; notranslate" title="">sudo gem install ruby-openid
sudo gem install authlogic
sudo gem install authlogic-oid
</pre>

<p>You can also set these in your environment.rb file, like so:</p>

<pre class="brush: ruby; title: ; notranslate" title="">config.gem "authlogic"
config.gem "authlogic-oid", :lib =&gt; "authlogic_openid"
config.gem "ruby-openid", :lib =&gt; "openid"
</pre>

<p>Note: I got thwarted when I tried running the app using the config.gem approach.  I kept getting an &#8220;Uninitialized constant Authlogic&#8221; in User_sessions.rb when I ran the app.  It sucked!  It took me a while to figure this out, but it was a horrible beginner mistake.  I was doing rake gems:install instead of sudo rake gems:install.  So when I ran my app, the proper gems weren&#8217;t in the right place.  Ouch!</p>

<p>Next, it&#8217;s time to install the open_id_authentication plugin which is required by Authlogic-oid.  It&#8217;s not available as a gem.</p>

<pre class="brush: bash; title: ; notranslate" title="">script/plugin install git://github.com/rails/open_id_authentication.git</pre>

<p>The next step is to create the necessary migration scripts for the open_id_authentication plugin.</p>

<pre class="brush: bash; title: ; notranslate" title="">rake open_id_authentication:db:create</pre>

<p>Another beginner mistake: I got a failure when I tried doing open_id_authentication:db:create before I installed the Authlogic gem.  Something about &#8220;acts_as_authenticated&#8221; wasn&#8217;t there.  So the order of installation is important!</p>

<p>Next, use the authlogic command to create the user_session model.  I&#8217;m prettying much following instructions from the Authlogic github pages at this point:</p>

<pre class="brush: bash; title: ; notranslate" title="">script/generate session user_session
script/generate model user
</pre>

<p>Another beginner mistake: if you&#8217;re making changes to your migration files without creating a new migration, make sure your schema is correct. I don&#8217;t know the best way to do this except by using rake db:drop, rake db:create, and rake db:migrate.  This was due to an error I was seeing in my view: &#8220;undefined method :openid_identifier&#8221;.  I had a text_field in my form for the openid field, and I had the openid_identifier field in my model.  The problem? It wasn&#8217;t in the database schema so Rails couldn&#8217;t do its thing to make it a property of the user model and render the textfield correctly.</p>

<p>From there, the views and controllers are pretty much the same as the example.  My user model is also pretty slim:</p>

<pre class="brush: ruby; title: ; notranslate" title="">class CreateUsers &lt; ActiveRecord::Migration
def self.up
create_table :users do |t|
t.string :email, :null=&gt;false
t.string :persistence_token, :null=&gt; false
t.string :openid_identifier, :null=&gt; false
t.datetime :last_request_at
t.timestamps
end
add_index :users, :openid_identifier
add_index :users, :persistence_token
end
def self.down
drop_table :users
end
end
</pre>

<p>Now, when I put everything together to run the app, I got some weird failures.  When trying to login using my OpenID, I got a nasty error:</p>

<pre class="brush: bash; title: ; notranslate" title="">undefined local variable or method 'crypted_password_field'</pre>

<p>Not having a crypted_pasword field made sense seeing how I wasn&#8217;t supporting login or password fields. But I wasn&#8217;t expecting <em>not</em> having it to be an issue.  In fact, from the docs the only required field on the user model is :persistance_token. So what&#8217;s going on?</p>

<p>Well, it turns out the Authlogic OpenID extension is designed to work with a login/password by default.  I had to dig through the stack trace and source code, but was able to figure out what&#8217;s going on.  There&#8217;s a method called <span class="name">attributes_to_save which is responsible for persisting form fields across the OpenID process.  By default, </span><span class="name">attributes_to_save includes password related information.  It treats the crypted password and password salt fields a little differently, which causes a problem when you don&#8217;t have a :crypted_password attribute on your model.  The solution is simple: just override the method with one which doesn&#8217;t include the password fields.  The user model will look like this:</span></p>

<p><span class="name"></p>

<pre class="brush: ruby; title: ; notranslate" title="">
class User &lt; ActiveRecord::Base
acts_as_authentic do |c|
def attributes_to_save # :doc:
attrs_to_save = attributes.clone.delete_if do |k, v|
[ :persistence_token, :perishable_token, :single_access_token, :login_count,
:failed_login_count, :last_request_at, :current_login_at, :last_login_at, :current_login_ip, :last_login_ip, :created_at,
:updated_at, :lock_version].include?(k.to_sym)
end
end
end
end
</pre>

<p>
  </span>
</p>

<p>
  The second mistake was because I got ahead of myself.  In the example app there&#8217;s code in the application.html.erb file rendering a login/register link or user info based on the current_user method in the application controller.  I was getting an error:
</p>

<pre class="brush: bash; title: ; notranslate" title="">unknown method 'logged_out?'</pre>

<p>
  <span class="n">which was occurring deep in the Authlogic codebase.  The problem was I didn&#8217;t go a good job copying everything I needed from the example files!  The authlogic example project used the</span>
</p>

<p>
  <span class="n">logout_on_timeout true</p> 
  

<p><p>
    </span>
  </p></p>

<p><p>
    <span class="n">filter on the UserSession method.  After digging through the documentation, this callback relies on the </span>
  </p></p>

<p><p>
    <span class="n"></p>

<pre><code>&lt;pre class=&quot;brush: ruby; title: ; notranslate&quot; title=&quot;&quot;&gt;
</code></pre>

<p>t.datetime :last_request_at
</pre></p>

<pre><code>&lt;p&gt;
  &lt;/span&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;span class=&quot;n&quot;&gt;field on the user model, which I didn&amp;#8217;t have at the time.  And not having this field was throwing everything off.  (The best part was the documentation clearly states you need that attribute on the model for the callback to work correctly.&lt;br /&gt; &lt;/span&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;span class=&quot;n&quot;&gt;Lesson learned: always know what you&amp;#8217;re doing. (Also: don&amp;#8217;t be afraid of source code).&lt;br /&gt; &lt;/span&gt;
&lt;/p&gt;

&lt;p&gt;
  The whole process has really made me appreciate Authlogic.  It&amp;#8217;s very extensible and extremely easy to customize.  If you know what you&amp;#8217;re doing it&amp;#8217;s pretty slick- the best way to figure it out is by reading the documentation and playing around with some code.
&lt;/p&gt;

&lt;p&gt;
  Good luck!
&lt;/p&gt;
</code></pre>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/03/scrum-tips-managing-task-items/">Scrum Tips: Managing Task Items</a></h1>
        <span class="post-date">Mar 11 2009</span>
        

<p>One of the biggest hurdles in transitioning to scrum is getting everyone- especially the dev team- on the same page.  Sprint planning and even scrum meetings can be painfully boring and seem useless.  There&#8217;s a lack of understanding of what to do, communication is either too little or too much, and a few people bad mouth the process and continue their heads down development.  You&#8217;re left wondering what&#8217;s the point- thinking it&#8217;s never going to work.  Well, have faith: proper task management is key in making scrum work for you and your team.  Task management is an aspect of scrum that&#8217;s entirely contained within the dev group, which makes implementation a lot easier.</p>

<h4 id="have-a-purpose:8e5df32093653ec1649dd5400ba44174">Have a Purpose</h4>

<p>The key is you- the scrummaster- need to provide an environment (like a framework) for scrum.  If you think by simply sending some scrum info around, meeting every day, and having a backlog will magically make everything better you&#8217;re wrong and you&#8217;ll fail.  You&#8217;ll also make everyone miserable.  The reason why &#8220;It gets worse before it gets better&#8221; is because it takes time to transition the team into the scrum process.  The key to success is facilitating that transition as quickly as possible, and the solution is having a purpose for everything you do.</p>

<p>That purpose comes via two simple rules which will help you and your team transition to scrum faster:</p>

<ol>
<li><strong>All developers should work on the same backlog item.</strong></li>
<li><strong>No task item should take more than four hours.</strong></li>
</ol>

<p>Think of these rules as grease in the wheels of scrum.  It keeps the machine moving.</p>

<h4 id="a-quick-refresher:8e5df32093653ec1649dd5400ba44174">A Quick Refresher</h4>

<p>A backlog item and task item are two different things.  A backlog item is something that&#8217;s business focused.  It&#8217;s specifically created by the product owner for the development team to implement.  It&#8217;s not, and shouldn&#8217;t be, developer focused in any way.  A task item, on the other hand, is developer focused.  It&#8217;s a list of things needed to be done to finish a backlog item.  Task items are created in either a sprint planning or a developer meeting at the start of a sprint.  They can also be refactored in the middle of the sprint.</p>

<p>A crucial step in scrum is having the team gauge complexity of backlog items.  This requires developers to have an understanding of what needs to be done from a user perspective- which is not something developers are usually good at.  Without understanding what needs to be done, they don&#8217;t know how to do it, and they can&#8217;t tell you how long it will take.  Another popular excuse is &#8220;I need to start coding to figure this out&#8221;.</p>

<p>The key is to make developers think and plan first so there are fewer variables mid sprint.  This is not mini-waterfall.  It&#8217;s strategy.</p>

<h4 id="how-the-rules-help:8e5df32093653ec1649dd5400ba44174">How the Rules Help</h4>

<p>Having everyone work on the same item is essential for scrum.  Why? If people are working on different items there&#8217;s little reason for them to communicate.  If Developer A is working on feature X, and Developer B is working on feature Y, there&#8217;s no reason for A or B to care what the other is doing.  In fact, it&#8217;s a waste of time.  However, if both A and B are working on feature X, there&#8217;s every reason in the world for the two to talk.  Not only talk, but collaborate.  It&#8217;s very XP without the side by side awkwardness.  The major benefit is the entire team is focused on the highest priority item- which means something will get completed in the sprint.  By working on single items together each item gets finished faster.  QA has more time to test- and they do it one at a time rather than dealing with multiple things coming together at the end of the sprint.</p>

<h4 id="break-things-down:8e5df32093653ec1649dd5400ba44174">Break Things Down</h4>

<p>The four hour rule is key to facilitate working together.  By breaking down every task into small pieces, more analysis is done on each backlog item.  The trick is each task is a single thing which can be done and checked in-  a class creation, a new method- all with unit tests.  The benefits materialize in different ways.  First, sprint planning becomes much more effective as communication occurs via the process of breaking down items.  Analysis is done and development ideas are thought out and debated amongst team members.  A roadmap is created outlining steps needed to complete each item- everyone is in the know and on the bus.</p>

<p>Why four hours? Easy: in theory, a developer should be able to get two four-hour tasks done between scrums.  A developer should never be in a position to say, &#8220;I&#8217;m working on X, and I&#8217;m still planning on working on X&#8221;.   (Unless, of course, they fall behind- in which case, break down the task again).  The point is you want to focus on granularity.  If you have to do a controller, a task of &#8220;Write a controller&#8221; is not adequate.  What are you doing? What actions are needed? What dependencies are there? Are you using ModelBinders, or method parameters? Where&#8217;s the error handling, if any?  The API and code structure evolves out of granular task items- and the whole team is part of the process, everyone on the same page as to what needs to get done. This level of discussion, collaboration, and task tracking are what you&#8217;re looking for.</p>

<p>Of course, it&#8217;s hard to get the entire team working on backlog items when they&#8217;re small.  It&#8217;s really your judgment call- but in my experience, there are only a few tasks which are too small to be worked on by more than one person in less than four hours.  The end of completing a backlog item is the most difficult when it&#8217;s a lot of little to dos.  But the things which take longer then they should are always the items worked on by one person- which usually aren&#8217;t properly tasked out.  The bottom line is there&#8217;s a constant cycle of breaking things down and redistribution.</p>

<p><strong>TDD</strong></p>

<p>A key factor to success is TDD.  TDD allows isolation of the moving parts.  In this way, a developer can work on a class, a method, or a service without having to worry about dependent objects.  The task description and sprint planning identify what the moving parts are, and how the moving parts fit together.  TDD is the environment to implement those moving parts, and make sure expectations are being met.  You&#8217;ll usually end up rewriting task items mid sprint.  That&#8217;s okay.  Sprint planing is really about establishing guidelines for development.  TDD is where the code and project materializes, and you need to change course when necessary as the project evolves.</p>

<p>Unit Tests provide a great way to review code.  If you&#8217;re working on a data layer for a business object, the business object developer can look at the data layer tests and get all the usage available.  Little time is spent &#8220;figuring it out&#8221;.  And if the business object developers mock objects don&#8217;t match the concrete ones, somebody wasn&#8217;t on the same page.  However, with small, iterative tasks taking a step back and refactoring is a non-issue.</p>

<h4 id="a-better-perspective-from-above:8e5df32093653ec1649dd5400ba44174">A Better Perspective from Above</h4>

<p>A great result of this process is the development lead or architect has great insight to how the application shapes up.  During sprint plannings, guidelines can be set on how to implement backlog items.  If something isn&#8217;t tasked out correctly, point out the issue and discuss.  Dependencies can be identified and spun off into new classes.  When issues arise during scrums, refactoring can happen and new directions can be taken- all in the presence of senior devs, which minimize one offs or crazy spaghetti code.  BTW writing spaghetti code is nearly impossible- it&#8217;s hard to make a mess in less than four hours when you&#8217;re only doing one specific thing and everyone is watching.</p>

<h4 id="mentoring:8e5df32093653ec1649dd5400ba44174">Mentoring</h4>

<p>This process works great for junior developers- they can learn from the entire team.  Similar to an architect having insight to a system, a junior developer has better access to seasoned developers.  One on one time is reduced in favor sprint planning and scrums.  Their work can be evaluated when code comes together for a backlog item.  Any developer is capable of answering a question because everyone is working on the same thing.</p>

<h4 id="cleaner-code:8e5df32093653ec1649dd5400ba44174">Cleaner Code</h4>

<p>Code reviews happen naturally when code is shared for feature development.  Consider the usual application stack: UI, Controller, Application, Domain, Data Layer.   This stack is no longer in the hands of one person, who either blurs the line between layers or creates a million helper classes.  Code review happens when the pieces gets fused together.  If the puzzle pieces don&#8217;t fit, refactor.  They usually will fit because everyone is clear on task items- because they were small, granular, and created together.</p>

<p>No one person is left to the whim of their own devices- the expectation is clear and apparent to the team during scrums.  And the best developers have a better surface area for showing off, by being exposed to the entire application and not regulated to a single feature. You&#8217;ll also get better exposure to cross functional teams, like UI.  When the Javascript developer and the backend developer are in the same room, creating the same roadmap, knowing what needs to be done, development is truly fluid.</p>

<h4 id="conclusion:8e5df32093653ec1649dd5400ba44174">Conclusion</h4>

<p>Scrum, at its core, is really about structure.  Each part is an important gear on the clock which helps the hands move smoothly.  A key to getting the team working in that structure is setting up an environment that meets the .  Task management is key for managing developers and the sprint.  The four hour task breakdown and single item focus are two tools for managing complexity and fostering communication.  The end result are the following benefits:</p>

<ol>
<li>Better gauge complexity of backlog items.</li>
<li>Complete work in priority order.</li>
<li>Fully meet Got Done criteria at end of sprint.</li>
<li>Understand where things are with development mid-sprint.</li>
<li>Understand why things are delayed with development mid-sprint.</li>
<li>Fix cohesion with development.  Specifically, enforce development standards and architecture guidelines, write clean code, and minimize hacks and bugs.</li>
<li>Top down visibility for architects, bottom up visibility for developers.</li>
</ol>

<p>Remember, task management is only part of the entire scrum process.  In order for scrum to be effective, everything must fall into place.  But task management will have an immediate benefit for you and your development team.</p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fwww.michaelhamrah.com%2fblog%2findex.php%2f2009%2f03%2fscrum-tips-managing-task-items%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fwww.michaelhamrah.com%2fblog%2findex.php%2f2009%2f03%2fscrum-tips-managing-task-items%2f&bgcolor=000099" border="0" alt="kick it on DotNetKicks.com" /></a></p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/03/prevent-js-and-css-browser-caching-issues-with-aspnet/">Prevent Js and Css Browser Caching Issues with ASP.NET</a></h1>
        <span class="post-date">Mar 2 2009</span>
        <p>You&#8217;ve seen this problem before- you deploy a new version of your website but the style is off and you&#8217;re getting weird javascript errors. You know the issue: Firefox or IE is caching and old version of the css/js file and it&#8217;s screwing up the web app. The user needs to clear the cache so the latest version is pulled. The solution: versionstamp your include files!</p>

<p>Take a lesson from Rails and create a helper which appends a stamp to your include files (and takes care of the other required markup). It&#8217;s simple- embed the following code in your views:</p>

<pre class="brush: csharp; title: ; notranslate" title="">&lt;%=SiteHelper.JsUrl("global.js") %&gt;
</pre>

<p>will render</p>

<pre class="brush: xml; title: ; notranslate" title="">&lt;script type="text/javascript" src="http://blog.michaelhamrah.com/content/js/global.js?33433651"&gt;&lt;/script&gt;
</pre>

<p>The browser will invalidate the cache because of the new query string and you&#8217;ll be problem free. Version stamps are better than timestamps because the version will only change if you redeploy your site.</p>

<p>Here&#8217;s the code, which is based on the AppHelper for Rob Conery&#8217;s Storefront MVC:</p>

<pre class="brush: csharp; title: ; notranslate" title="">using System.Reflection;
using System.Web.Mvc;

namespace ViewSample
{
public static class SiteHelper
{
private static readonly string _assemblyRevision = Assembly.GetExecutingAssembly().GetName().Version.Build.ToString() + Assembly.GetExecutingAssembly().GetName().Version.Revision.ToString();

/// &lt;summary&gt;
/// Returns an absolute reference to the Content directory
/// &lt;/summary&gt;
public static string ContentRoot
{
get
{
return "/content";
}
}

/// &lt;summary&gt;
/// Builds a CSS URL with a versionstamp
/// &lt;/summary&gt;
/// &lt;param name="cssFile"&gt;The name of the CSS file&lt;/param&gt;
public static string CssUrl(string cssFile)
{

string result = string.Format("&lt;link rel='Stylesheet' type='text/css' href='{0}/css/{1}?{2}' /&gt;", ContentRoot, cssFile, _assemblyRevision);
return result;
}
/// &lt;summary&gt;
/// Builds a js URL with a versionstamp
/// &lt;/summary&gt;
/// &lt;param name="cssFile"&gt;The name of the CSS file&lt;/param&gt;
public static string JsUrl(string jsPath)
{
return string.Format("&lt;script type='text/javascript' src='{0}/js/{1}?{2}'&gt;&lt;/script&gt;", ContentRoot, jsPath, _assemblyRevision);
}

}
}

</pre>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/02/wiping-out-inherited-css-styles/">Wiping Out Inherited CSS Styles</a></h1>
        <span class="post-date">Feb 27 2009</span>
        <p>Sure, you can use the !important css keyword in your stylesheets to override inherited styles, but what about when you want to simply wipe out or remove a style defined in a parent? Use the auto keyword.</p>

<p>Let&#8217;s say you have a style defined in a global.css sheet defining a position for a class called menu:</p>

<pre class="brush: css; title: ; notranslate" title="">ul.menu {
position:absolute;
left: 10px;
top: 10px;
}
</pre>

<p>This will position a <ul class=&#8221;menu&#8221;> element</ul> 10 pixels away from the top left corner of the parent element.  But what if you want to move that menu to the right side of the parent element, but you can&#8217;t change the defined style in global.css?</p>

<p>You create a new stylesheet or define an inline style, and override the ul.menu class by specifying</p>

<pre class="brush: css; title: ; notranslate" title="">ul.menu {
right:10px;
}
</pre>

<p>But this simply stretches the menu to the other corner.   We need to override the left:10px; style with the default style (as if we never specified the left:10px; to begin with).  left:none; won&#8217;t work and left:0; won&#8217;t either.  The solution is the auto keyword:</p>

<pre class="brush: css; title: ; notranslate" title="">ul.menu {
right:10px;
left:auto; /* removes left:10px from parent */
}
</pre>

<p>Voila, you&#8217;re done!  It&#8217;s as if the left:10px was never defined!</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/02/tips-for-managin-aspnet-mvc-views/">Tips for Managing ASP.NET MVC Views</a></h1>
        <span class="post-date">Feb 25 2009</span>
        <p>After working on an ongoing ASP.NET MVC project for a couple of months I&#8217;ve learned a couple of lessons when it comes to dealing with Views.  Keep as much logic out of the views as possible! This can be tricky because it&#8217;s so easy to let code sneak into your views. But by following the tips below you&#8217;ll be able to keep your logic organized and views clean.</p>

<p><strong>1) Follow the Rails pattern of having a Helper class for each controller.  The helper class deals with html snippets or formatting functions on a per controller level.</strong></p>

<p><a href="http://i1.wp.com/www.michaelhamrah.com/blog/wp-content/uploads/2009/02/helpersfolder.png"><img class="alignnone size-medium wp-image-174" title="ASP.NET MVC Helpers" src="http://i1.wp.com/www.michaelhamrah.com/blog/wp-content/uploads/2009/02/helpersfolder.png?resize=211%2C159" alt="ASP.NET MVC Helpers" data-recalc-dims="1" /></a></p>

<p>Pushing out bits of code like date formatting into helper classes not only cleans up the views, but aids in testability.  Logic is consolidated in one place simplifying maintenance.  Creating Helpers on a per controller level also creates a namespace where functionality can be found intuitively.</p>

<p><strong>2) Don&#8217;t overload the Html helper with one-off functions. Organize functions into their respective helper classes.</strong></p>

<p>It&#8217;s so easy to want to add extension methods to the HtmlHelper class.  It&#8217;s like a siren crying out &#8220;do it, do it&#8221;.  This is bad!  Extension methods are good for some things, but can easily garble an API.  The HtmlHelper class should be reserved for rendering core html elements.  As an alternative, leverage helper classes you create on a per-controller basis.</p>

<pre class="syntax c#">//These shouldn't belong to HtmlHelper!
public static string ShowSomethingOnlyForHomeController((this HtmlHelper helper) ...
public static string RenderDateTimeNowInSpan(this HtmlHelper helper) ...</pre>

<p><strong>3) Leverage partial views for iterative content, even if it&#8217;s not reused elsewhere (hint: it probably will be eventually).</strong></p>

<p>So instead of:</p>

<pre class="syntax c#">&lt;%= foreach (var photo in photos)
{ %>


<div class="photo">
  <span>&lt;%= photo.Name %></span>
  
  
  <p>
    &lt;%= photo.Description %>
  </p>
  
  
  <p>
    &lt;%= photo.Date %>
  </p>
  
</div>
&lt;%= } %>
</pre>

<p>use:</p>

<pre class="syntax c#">&lt;% foreach (var photo in photos)
{ %>
&lt;% Html.RenderPartial("~/Views/Photos/PhotoTemplate", photo); %>
&lt;% } %>
</pre>

<p>This will greatly minimize the amount of markup scattered throughout a view, keeping view files focused on a specific task (just like good class design).  It&#8217;ll also make version control easier because changes will be isolated to their respective file, allowing someone to better see what changes happened where.  It also eliminates excessive merging.</p>

<p><strong>4) Organize partial views within their respective controller, not a shared folder- even if it&#8217;s a global skin.</strong></p>

<p>Dumping partials within a shared folder can cause overcrowding and jumbling in the long term.  Prefer organization and grouping of related content (again, just like good class design).</p>

<p><strong>5) Prefer a strongly typed view and leverage specialized ViewData types for aggregating random models under one root.</strong></p>

<p>It can be easy to dump stuff into the ViewData hash.  However, prefer using a custom ViewData class instead.  It&#8217;s easier to know what data is available for the view.  This is a lot more intuitive than rummaging through a controller, which happens when teams share code.  Also leverage the <a href="http://en.wikipedia.org/wiki/Null_Object_pattern">null object pattern</a> for properties to avoid having to do null reference checks in the views.</p>

<p>Instead of:</p>

<pre class="syntax c#">ViewData["Title"] = "My Photos";
ViewData["Photos"] = myPhotos;
ViewData["User"] = currentUser;

return View();
</pre>

<p>use:</p>

<pre class="syntax c#">//Title and User can be properties of a base view data class.
var vd = new PhotoListViewData() 
     { Photos = myPhotos, Title = "My Photos", User = currentUser };
return  View(vd);

//Sample null object pattern (always returns a valid object, so no if null or Count == 0):
private List&lt;Photo> _photos = new List&lt;Photo>();
public List&lt;Photo> Photos 
{ 
get 
     { if (_photos == null) _photos = new List&lt;Photo>(); 
            return _photos; 
     } 
set { 
        _photos = value; } 
}
</pre>

<p><strong>6) Minimize code snippets in views.</strong></p>

<p>Code snippets occur in many ways.  They can be as simple as formatting a date, to string concatenation, to even doing a grouping/projection to get data correct.  Doing this in a view easily leads to bugs and isn&#8217;t testable.  Any data processing specifically for views should occur in the controller action, custom ViewData object itself, or in a helper class.  Code in views should be simplified to looping, calling a property, or calling a single method.  Anything more than that will get you into trouble!</p>

<p><strong>Leverage RenderAction or MvcContrib&#8217;s SubController for dealing with shared isolated functionality not relevant to a view.</strong></p>

<p>Unfortunately, as of RC1 there still isn&#8217;t a great way to deal with aggregating disparate content in an action.  You&#8217;ll need to resort to the RenderAction in the Future&#8217;s dll or use MvcContrib&#8217;s SubController.  The point is the same- keep actions specific to what you&#8217;re doing.  If you need to aggregate disparate content in a view (like a menu in the header, or a shopping cart) offload functionality into an action and call RenderAction.  Having actions do multiple, random things leads to messy code.  Prefer a single point of entry into supporting view content.</p>

<p>Good luck and share your tips!</p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fwww.michaelhamrah.com%2fblog%2findex.php%2f2009%2f02%2ftips-for-managin-aspnet-mvc-views%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fwww.michaelhamrah.com%2fblog%2findex.php%2f2009%2f02%2ftips-for-managin-aspnet-mvc-views%2f&bgcolor=0000FF" border="0" alt="kick it on DotNetKicks.com" /></a></p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/02/using-moq-3-to-implement-tests-and-avoid-stubs/">Using Moq to Implement Tests (and Avoid Stubs)</a></h1>
        <span class="post-date">Feb 25 2009</span>
        

<p>In <a href="http://www.michaelhamrah.com/blog/index.php/2008/12/understand-unit-testing-and-td-getting-better-code-coverage/">my previous post on understanding TDD</a> I discussed how to analyze existing code for creating unit tests.  This was somewhat of &#8220;reverse TDD&#8221;, the idea being to look for what to needs to be tested- the relationship between what one class expects and what another class actually does.  Unfortunately I stopped short of actually implementing those tests- which is the subject of this post.</p>

<p>As a quick refresher, our demo app has some simple functionality which involves getting an order from a data tier then uses a shipping service to ship the order.  You can <a href="http://www.michaelhamrah.com/blog/wp-content/uploads/2009/02/unittestexamplewithmoq.zip">download the sample app here</a>.</p>

<h3 id="prefer-mocking-over-stubs:dc6d1fe85225b3a1b9bf1fc833403f60">Prefer Mocking Over Stubs</h3>

<p>Had I written this post about two months ago, I would have favored creating a suite of stub classes to mimic the expected behavior of our interfaces.  The approach would involve creating various stub classes for our dependent interfaces- the IShippingService and IOrderRepository- and plugging those stubs into the various unit tests.  In the simplest sense these would be hard coded classes to do what I wanted- from throwing exceptions to hard coding return values.  Probably even use some fancy random number generation for ids. However, I&#8217;m learning from a current project that the stub approach isn&#8217;t the best route to take.</p>

<h4 id="the-problem-distilled:dc6d1fe85225b3a1b9bf1fc833403f60">The Problem, Distilled</h4>

<p>Stubbing is definitely easy, but code quickly spirals out of control.  With stub classes, especially those backed by interfaces, more classes are created which then need to be managed and supported.  In an evolving software project this management creates added infrastructure which gets in the way when making changes to the original functionality.  An interface change, for example (either adding a new method or refactoring parameters) causes numerous changes to be made in stubbed out classes.  What&#8217;s worse, there can easily be a divergence in the behavior of the stubbed out class with the behavior it&#8217;s supposed to represent.  True, this can happen with mocking, but as we&#8217;ll see mocking is much more granular and can be tailored to specific circumstances with minimal code duplication.</p>

<p>There&#8217;s simply no need to create extensive, or multiple, stub objects with all those great mocking frameworks around.  Most mocking frameworks offer a ton of features creating granular control of expectations, return values, parameter verification, and method invocation checking.  I strongly recommend reading Martin Fowler&#8217;s <a href="http://martinfowler.com/articles/mocksArentStubs.html">Mocks Aren&#8217;t Stubs</a> article for more information on the difference between mocks and stubs.</p>

<h3 id="using-moq-to-mimic-behavior:dc6d1fe85225b3a1b9bf1fc833403f60">Using Moq to Mimic Behavior</h3>

<p>We&#8217;ll use <a href="http://code.google.com/p/moq/">Moq</a> 3 to demo what you can do with mocking.  Let&#8217;s start off with our first unit test, ShipOrder_Returns_New_Shipment_With_Order_Items.  We simply want to call our ShipOrder function and ensure we get a shipment back with shipment items.  To begin with, we&#8217;ll use <a href="http://code.google.com/p/moq/">Moq</a> to mock our IOrderStorage and IShipmentService so we can construct our OrderShipmentManager.</p>

<pre class="syntax c#">[TestMethod()]
public void OrderShipmentManager_ShipOrder_Returns_New_Shipment_With_Shipment_Items()
{
var mockOrderStorage = new Mock&lt;IOrderStorage>();
var mockShipmentService = new Mock&lt;IShipmentService>();

var osm = new OrderShipmentManager(mockOrderStorage.Object, mockShipmentService.Object);

var shipment = osm.ShipOrder(5);

Assert.IsNotNull(shipment, "Returned Shipment was not null");
Assert.IsInstanceOfType(shipment, typeof(Shipment), "Returned object was not of type shipment.");
Assert.IsNotNull(shipment.ShipmentProducts, "ShipmentProducts were null");
Assert.IsTrue(shipment.ShipmentProducts.Count > 0, "ShipmentProducts were empty");
}
</pre>

<p>This test will fail because we haven&#8217;t specified any functionality for our interfaces!  But, we didn&#8217;t get a failing test with a null reference exception when calling GetOrder()- we got a failing test because our returned shipment object from GetOrder was null.  Stepping through code you&#8217;ll see that Moq returned void when calling the IOrderStorage.GetOrder method.  Moq creates a simple &#8220;dumb&#8221; proxy class for the interface automatically.  You can specify a strict behavior using MockBehavior.Strict in the constructor to throw an exception for anything that isn&#8217;t explicitly set up.  This can be helpful for ensuring control flow.</p>

<p>The solution to pass our test is to explicitly tell Moq what to do when this method is called, like so:</p>

<pre class="syntax c#">mockOrderStorage.Setup(os => os.GetOrder(It.IsAny&lt;int>())).Returns((int id) => {
var order = new Order() { OrderId = id };
return order;
});
</pre>

<p>When working with Moq you may struggle with the extensive use of Lambda expressions the framework requires.  But after a couple of tests you&#8217;ll become a lambda ninja.  Moq relies on a pair of Setup/Return calls to dictate behavior.  Also notice how we didn&#8217;t have to implement every method in our interfaces- we only had to implement the ones we needed to make the test pass.  That saves a lot of code from being written!</p>

<p>The previous expression states &#8220;when you call GetOrder, with any int value, return a new order with the input id&#8221;.  Moq gives a lot of power in dictating the behavior of the return call based on the expected function.  By specifing (int id) in our return Lambda we can get a reference to our input parameter, which helps us construct a valid Order object based on any input. This is helpful when setting up exceptions.  By using a predicate expression with It.Is instead of It.IsAny, we can have our call throw an exception for an invalid input:</p>

<pre class="syntax c#">mockShipmentService.Setup(ss => ss.CreateShipment(It.Is&lt;int>(id => id &lt; 0))).Throws&lt;ArgumentException>();
</pre>

<p>Setting up exceptions using Moq is instrumental in properly dealing with exception handling in your code.  Also, using It.Is to tailor return methods can help out when dealing with validation or verifying state.  It&#8217;s much faster and easier to use Moq to create behavior than hard coding stub classes.</p>

<p>There&#8217;s one final advantage to using Moq which you can&#8217;t easily do with stubs.  It&#8217;s verifying method invocation.  In our sample project, we have a call to _shipmentService.Ship(shipment).  What does Ship() do? It doesn&#8217;t return anything so checking a return parameter is difficult.  It doesn&#8217;t manipulate the shipment (or, let&#8217;s pretend it doesn&#8217;t).  We want to ensure this function is called.  The solution? Use Moq&#8217;s Verify() method, like so:</p>

<pre class="syntax c#">mockShipmentService.Verify(svc => svc.Ship(shipment));
</pre>

<p>This code will throw an exception if Ship wasn&#8217;t called with the shipment variable, ensuring that Ship was actually called if it should.  Using Verify() is helpful when testing out methods returning void- like sending an e-mail, doing a file operation, or ftp.</p>

<h3 id="conclusion:dc6d1fe85225b3a1b9bf1fc833403f60">Conclusion</h3>

<p>Spending some time getting up to speed with a mocking framework will be instramental in learning TDD.  It&#8217;ll also come in handy with just writing unit tests.  Mocking provides a simple, slimmed down solution that&#8217;s much easier to manage than stub classes.</p>

<p>I like Moq because it&#8217;s quick to express what you want done- but the heavy use of lambdas can be a struggle with getting started.  The <a href="http://code.google.com/p/moq/wiki/QuickStart">moq quickstart</a> is a great guide to the framework and covers all the bases.  The bottom line is don&#8217;t worry about which mocking framework you choose.  They all have their respective advantages.  Pick one, learn it, use it.  If you don&#8217;t like how it does something, switch to something else down the line which does what you want.</p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fwww.michaelhamrah.com%2fblog%2findex.php%2f2009%2f02%2fusing-moq-3-to-implement-tests-and-avoid-stubs%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fwww.michaelhamrah.com%2fblog%2findex.php%2f2009%2f02%2fusing-moq-3-to-implement-tests-and-avoid-stubs%2f&#038;bgcolor=0000FF" border="0" alt="kick it on DotNetKicks.com" /></a></p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="http://blog.michaelhamrah.com/2009/02/how-to-hire-a-software-developer-the-in-house-interview-part-two/">How to Hire a Software Developer: The In House Interview (Part Two)</a></h1>
        <span class="post-date">Feb 23 2009</span>
        

<p>_Note: This is part of a series on hiring software developers.  See <a title="Interview" href="http://www.michaelhamrah.com/blog/index.php/tag/interview/" target="_self">articles tagged with interview for the series</a>.  The in house interview post has two parts.  This part focuses on non-development questions._</p>

<h3 id="key-concepts:3dcafca7ca783ca88343fc510ece7ff5"><strong>Key Concepts</strong></h3>

<ol>
<li>Present yourself well- the candidate is checking you out too.</li>
<li>Prefer a group style interview approach over one-on-ones.</li>
<li>Ask specific non-development questions and evlove the follow ups.</li>
</ol>

<h3 id="they-8217-re-interviewing-you-too:3dcafca7ca783ca88343fc510ece7ff5">They&#8217;re Interviewing You Too</h3>

<p>It&#8217;s important to note that you- both as a company, a potential co-worker, or a future boss- are being interviewed too.  A smart candidate (read: one you want to hire) will be sizing up the situation and the interview process themselves.  What&#8217;s the office like?  Do people know what&#8217;s going on?  Where is the interview going to happen? Am I, the candidate, waiting around a lot for something to happen, or someone to do something? How fluid is the entire process?  Are people droning on at their desks or do they look happy?</p>

<p>What goes on during the interview will give the developer hints as to what to expect during the day to day of the job. If the office is awesome, the people are cool, and things are moving smoothly, a much better impression will be made on the candidate than a sloppy process where people are totally frazzled, have no interest in what&#8217;s going on, or are treated/act like sheep.</p>

<p>Bottom line: be respectful.  Present yourself- and your company- as the epitome of who you&#8217;re expecting to hire.  Joel Spolsky, of <a href="http://www.joelonsoftware.com">Joel on Software</a>, puts great effort into making his office and company a kick-ass place.  Even his blog makes you sit at your desk wishing you worked at Fog Creek.  Hell, the New York Times <a href="http://www.nytimes.com/2009/02/08/realestate/commercial/08sqft.html?_r=1&amp;partner=permalink&amp;exprod=permalink">even wrote an article</a> on the office architecture!  Don&#8217;t be afraid to sell yourself.</p>

<h3 id="the-interviewers:3dcafca7ca783ca88343fc510ece7ff5">The Interviewers</h3>

<p>It&#8217;s important to have the candidate meet with a variety of team members.  This shouldn&#8217;t be considered a chore for people, but an honor.  It&#8217;s important when building a cohesive team to give current members a voice as to who&#8217;s joining the team.  Most people have no idea how to interview- so make sure to give current members specific questions, role playing scenarios or guidelines on how to conduct the interview.  Make sure meetings are timed box- to between 5 to 20 minutes- so the interviewer knows the correct pace.  There&#8217;s nothing worse than awkward silence.</p>

<h3 id="the-interview-structure:3dcafca7ca783ca88343fc510ece7ff5">The Interview Structure</h3>

<p>There are essentially two ways to structure the interview: a series of one on one interviews where different developers ask a distinct set of questions, or a group style interview where a group of developers have a round table discussion with a candidate.  The way you decide to structure the interview says a lot about your company and how you conduct your development (that whole thing about presenting yourself).</p>

<p>Personally, I don&#8217;t like the one-on-one style.  It&#8217;s pretty exhaustive, both for you and the candidate.  The candidate is constantly bombarded with questions in an interrogation-like manner.  If the questions aren&#8217;t planned ahead of time people will also ask the same set of questions (Um,  so, why are you leaving your job? Why do you want to work here?).  More importantly, it&#8217;s hard for the candidate to get into a rhythm- the mandatory warm up time, body, and wrap up is just too cramped.  Finally, the one on one approach offers poor breadth of a candidate.  If each person is only focusing on a specific set of questions, no one person can see the big picture.</p>

<p>A roundtable discussion is a much better approach, even if there are only two interviewers.  This is much more representative of an agile development team- you want to see how the group dynamic plays with a new person.  It also gives every person an opportunity to determine breadth- you see the whole package, and not just individual parts.  The conversation has a much better chance to evolve in a solid discussion- the positive attributes of each interviewer can shine while the negative attributes are mitigated by the group.</p>

<p>The one advantage to the one-on-one style is you can interview more people easily.  It&#8217;s just math- let&#8217;s say you&#8217;re interviewing four candidates with four developers.  An interview should last about two hours.  That&#8217;s eight hours using all four developers!  On the other hand, if each developer spent 30 minutes with each candidate concurrently, that&#8217;s only four hours total- half the time!</p>

<h3 id="personal-non-technical-questions:3dcafca7ca783ca88343fc510ece7ff5">Personal/Non-Technical Questions</h3>

<p>It&#8217;s important to ask non-development questions.  You want to get a sense of how well rounded a candidate is and what their personality is like.  Here are some example questions:</p>

<p><strong>How do you stay on top of technology?</strong></p>

<p>I&#8217;m looking to know what their go-to resources are for learning and keeping up with stuff.  Google is not a good answer.  Do they read blogs? What are their favorite books? Have they been to any conferences?  Subscribe to any magazines?  What can they bring to the table?</p>

<p style="margin-left: 1.6pt;">
  <strong>What personal program projects have you worked on, if any?</strong>
</p>

<p style="margin-left: 1.6pt;">
  I&#8217;m interested to know if they have any programming experience outside of work.  Not too bad if they don&#8217;t, but it shows how into programming they are.
</p>

<p style="margin-left: 1.6pt;">
  <strong>What is the coolest thing you&#8217;ve done with technology? What are you proud of?</strong>
</p>

<p style="margin-left: 1.6pt;">
  One of my favorites.  It&#8217;s important to hire people who are proud of what they do.  You can&#8217;t beat someone who&#8217;s about personal responsibility.
</p>

<p style="margin-left: 1.6pt;">
  <strong>What are some websites you&#8217;ve used where you appreciate the design of the site? Why?</strong>
</p>

<p style="margin-left: 1.6pt;">
  An analytical question.  Developers with design insight are rare.  A developer who shows appreciation for good design, or can &#8220;talk&#8221; design, is invaluable.
</p>

<p style="margin-left: 1.6pt;">
  <strong>What do you want to be doing in a couple of years? What is one area where you want to be developing your skill set?</strong>
</p>

<p style="margin-left: 1.6pt;">
  I used to hate asking this question because its so cookie cutter.  But it&#8217;s important to ask and to have the candidate elaborate on.  It does two things- let you know how driven the candidate is, and what they&#8217;re interested in doing and evolving.  Both important things to know.  A good follow up is &#8220;How are you going to do that?&#8221;
</p>

<p><strong><span style="color: black;">Describe how you would handle a situation if you were required to finish multiple tasks by the end of the day, and there was no conceivable way that you could finish them. </span></strong></p>

<p>Answer: Prioritize.</p>

<p><strong><span style="color: black;">If you could get rid of any one of the US states, which one would you get rid of, and why? </span></strong></p>

<p><span style="color: black;"><strong> </strong></span></p>

<p>Answer: Canada.  Just kidding.  This one&#8217;s good to change pace of the conversation if needed.  Ask if the candidate completely failed another question or is feeling insecure.  It can help them get on track.  It&#8217;s one of those silly filler questions that&#8217;s good at wasting time if you need too or changing the mood.</p>

<p><span style="color: black;"><strong>With your eyes closed, tell me step-by-step how to tie my shoes.</strong> </span></p>

<p><strong><span style="color: black;">If selected for this position, can you describe your strategy for the first 90 days?</span></strong></p>

<p>You may not need this if you&#8217;re doing role-playing development questions, but it&#8217;s a good question to gauge how well a candidate can explain something.</p>

<p><strong><span style="color: black;">Describe a criticism you were given at a job and how you worked to improve it.</span></strong></p>

<p><span style="color: black;">This is another good question to ask.  Most people don&#8217;t respond well to criticism, or aren&#8217;t that self critical.  You don&#8217;t want someone to be cocky nor beat themselves up.  But there are times when people do things they shouldn&#8217;t or simply make mistakes.  Being self-aware and improving on weaknesses is one of the best qualities a person can have.</span></p>

<p><span style="color: black;"><br /> </span></p>

    </div>
  
</div>

<div class="pagination">
  
  <a class="pagination-item older" href="http://blog.michaelhamrah.com/page/9/">Older</a>
  

  
  <a class="pagination-item newer" href="http://blog.michaelhamrah.com/page/7/">Newer</a>
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-6576586-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

